<?xml version="1.0" ?>
{% set wheel_separation = 0.14 %}
{% set wheel_diameter = 0.06 %}
{% set wheel_thickness = 0.02 %}
{% set x_front_axle = 0.08 %}
{% set x_rear_axle = -0.08 %}
{% set z_axle = -0.01 %}

{# general geometry #}
{%- set wheel_data_list = [
  {'name': 'front_left', 'x': x_front_axle,  'y': wheel_separation/2,  'z': z_axle},
  {'name': 'front_right', 'x': x_front_axle, 'y': -wheel_separation/2, 'z': z_axle},
  {'name': 'rear_left', 'x': x_rear_axle,  'y': wheel_separation/2, 'z': z_axle},
  {'name': 'rear_right', 'x': x_rear_axle, 'y': -wheel_separation/2,  'z': z_axle},
]%}

{%- macro box(name, color, x, y, z, l, w, h) -%}
<visual name='{{name}}_visual'>
  <pose>{{x}} {{y}} {{z}} 0 0 0</pose>
  <geometry>
    <box>
      <size>{{l}} {{w}} {{h}}</size>
    </box>
  </geometry>
  <material>
    <script>
      <uri>file://media/materials/scripts/gazebo.material</uri>
      <name>Gazebo/{{color}}</name>
    </script>
  </material>
</visual>

<collision name='{{name}}_collision'>
  <pose>{{x}} {{y}} {{z}} 0 0 0</pose>
  <geometry>
    <box>
      <size>{{l}} {{w}} {{h}}</size>
    </box>
  </geometry>
</collision>
{% endmacro -%}

{%- macro inertial(m, ixx, iyy, izz) -%}
<inertial>
  <mass>{{m}}</mass>
  <inertia>
    <ixx>{{ixx}}</ixx>
    <iyy>{{iyy}}</iyy>
    <izz>{{izz}}</izz>
  </inertia>
</inertial>
{% endmacro -%}

<sdf version="1.7">
  <model name='freenove_4wd'>
    <pose>0 0 0 0 0 0</pose>

    <link name='chassis'>
      {{ inertial(0.2, 0.01, 0.01, 0.01)|indent(6) }}
      {{ box('chassis', 'DarkGrey', 0, 0, 0, 0.2, 0.1, 0.03)|indent(6) }}
      {{ box('computer', 'Green', -0.05, 0, 0.03, 0.1, 0.07, 0.01)|indent(6) }}
    </link>

    {%- for data in wheel_data_list %}
    <link name="{{data.name}}">
      <pose>{{data.x}} {{data.y}} {{data.z}} -1.5707 0 0</pose>
      {{ inertial(0.005, 0.0001, 0.0001, 0.0001)|indent(6) }}
      <collision name="collision">
        <geometry>
          <cylinder>
            <radius>{{wheel_diameter/2}}</radius>
            <length>{{wheel_thickness}}</length>
          </cylinder>
        </geometry>
      </collision>

      <visual name="tire">
        <geometry>
          <cylinder>
            <radius>{{wheel_diameter/2}}</radius>
            <length>{{wheel_thickness}}</length>
          </cylinder>
        </geometry>
        <material>
          <script>
            <uri>file://media/materials/scripts/gazebo.material</uri>
            <name>Gazebo/DarkGrey</name>
          </script>
        </material>
      </visual>

      <visual name="wheel">
        <geometry>
          <cylinder>
            <radius>{{wheel_diameter/2*0.95}}</radius>
            <length>0.022</length>
          </cylinder>
        </geometry>
        <material>
          <script>
            <uri>file://media/materials/scripts/gazebo.material</uri>
            <name>Gazebo/Yellow</name>
          </script>
        </material>
      </visual>

      <visual name="wheel_line">
        <geometry>
          <box>
            <size>0.053 0.01 0.024</size>
          </box>
        </geometry>
        <material>
          <script>
            <uri>file://media/materials/scripts/gazebo.material</uri>
            <name>Gazebo/DarkGrey</name>
          </script>
        </material>
      </visual>

      <visual name="wheel_line2">
        <geometry>
          <box>
            <size>0.01 0.053 0.024</size>
          </box>
        </geometry>
        <material>
          <script>
            <uri>file://media/materials/scripts/gazebo.material</uri>
            <name>Gazebo/DarkGrey</name>
          </script>
        </material>
      </visual>

    </link>

    <joint type="revolute" name="{{data.name}}_joint">
      <child>{{data.name}}</child>
      <parent>chassis</parent>
      <axis>
        <xyz>0 0 1</xyz>
        <dynamics>
          <friction>0.01</friction>
          <damping>0.01</damping>
        </dynamics>
      </axis>
    </joint>
    {% endfor %}
    <plugin name="skid_steer_drive_controller" filename="libgazebo_ros_skid_steer_drive.so">
      <updateRate>100.0</updateRate>
      <robotNamespace/>
      <leftFrontJoint>front_left_joint</leftFrontJoint>
      <rightFrontJoint>front_right_joint</rightFrontJoint>
      <leftRearJoint>rear_left_joint</leftRearJoint>
      <rightRearJoint>rear_right_joint</rightRearJoint>
      <wheelSeparation>{{wheel_separation}}</wheelSeparation>
      <wheelDiameter>{{wheel_diameter}}</wheelDiameter>
      <robotBaseFrame>rover_ground_truth</robotBaseFrame>
      <torque>0.3</torque>
      <broadcastTF>true</broadcastTF>
      <commandTopic>cmd_vel</commandTopic>
      <odometryTopic>rover_odom</odometryTopic>
      <odometryFrame>map</odometryFrame>
      <covariance_x>0.0001</covariance_x>
      <covariance_y>0.0001</covariance_y>
      <covariance_yaw>0.0001</covariance_yaw>
    </plugin>
  </model>
</sdf>
<!-- vim: set et fenc=utf-8 ff=unix sts=0 sw=2 ts=2 : -->
